<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>브이월드 2D 항공영상 지도</title>

<!-- ✅ 브이월드 2.0 SDK -->
<script src="https://map.vworld.kr/js/vworldMapInit.js.do?version=2.0&apiKey=BE552462-0744-32DB-81E7-1B7317390D68"></script>

<style>
body { margin:0; font-family:Arial,sans-serif; }
#topbar {
  background:#0b69a3; color:white; padding:10px;
  display:flex; align-items:center; gap:10px;
}
#addrInput { flex:1; padding:6px; border:1px solid #ccc; border-radius:4px; }
button {
  background:#ff8a00; color:white; border:none;
  padding:6px 12px; border-radius:4px; cursor:pointer;
}
#map { width:100%; height:90vh; }
#info { padding:8px; background:#f5f5f5; font-size:14px; }
</style>
</head>

<body>
  <div id="topbar">
    <span>주소 입력:</span>
    <input id="addrInput" placeholder="예: 전라남도 해남군 북평면 동해길 43-36">
    <button id="searchBtn">찾기</button>
    <button id="resetBtn">초기화</button>
  </div>
  <div id="map"></div>
  <div id="info">지도 준비 중...</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
const apiKey = "BE552462-0744-32DB-81E7-1B7317390D68";
let vmap, markerLayer;

// ✅ 지도 초기화 (항공영상 2D)
function initMap() {
  vw.ol3.MapOptions = {
    basemapType: vw.ol3.BasemapType.PHOTO, // ✅ 항공영상(위성지도)
    controlDensity: vw.ol3.DensityType.BASIC,
    interactionDensity: vw.ol3.DensityType.BASIC,
    controlsAutoArrange: true,
    homePosition: vw.ol3.CameraPosition, 
    initPosition: vw.ol3.CameraPosition
  };

  vmap = new vw.ol3.Map("map", vw.ol3.MapOptions);

  // ✅ 마커 레이어 생성
  markerLayer = new vw.ol3.layer.Marker(vmap);
  vmap.addLayer(markerLayer);

  $("#info").text("항공영상 지도 준비 완료. 주소를 입력하세요.");

  $("#searchBtn").on("click", searchAddress);
  $("#resetBtn").on("click", resetMap);
}

// ✅ 주소 검색
function searchAddress() {
  const addr = $("#addrInput").val().trim();
  if (!addr) return alert("주소를 입력하세요.");
  $("#info").text("주소 좌표 변환 중...");

  $.ajax({
    url: "https://api.vworld.kr/req/address",
    dataType: "jsonp",
    data: {
      service: "address",
      request: "getCoord",
      key: apiKey,
      type: "ROAD",
      format: "json",
      address: addr
    },
    success: function(res) {
      const point = res?.response?.result?.point;
      if (!point) return $("#info").text("주소를 찾을 수 없습니다.");
      const lon = parseFloat(point.x);
      const lat = parseFloat(point.y);
      addMarker(lon, lat);
      $("#info").text(`좌표(${lon}, ${lat})`);
    },
    error: () => $("#info").text("주소 변환 실패")
  });
}

// ✅ 마커 표시
function addMarker(lon, lat) {
  markerLayer.clear();
  vw.ol3.markerOption = {
    x: lon, y: lat, epsg: "EPSG:4326",
    title: "검색 위치",
    contents: "입력한 주소의 위치입니다.",
    iconUrl: "https://map.vworld.kr/images/ol3/marker_blue.png"
  };
  markerLayer.addMarker(vw.ol3.markerOption);

  const center = ol.proj.transform([lon, lat], "EPSG:4326", "EPSG:900913");
  vmap.getView().setCenter(center);
  vmap.getView().setZoom(19);
}

// ✅ 초기화
function resetMap() {
  markerLayer.clear();
  $("#info").text("지도 초기화 완료.");
}

// ✅ 실행
$(document).ready(initMap);
</script>
</body>
</html>
